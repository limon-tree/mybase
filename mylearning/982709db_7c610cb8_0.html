<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<style>
			body, table{font-family: 微软雅黑}
			
			table{border-collapse: collapse; border: 1px solid gray; border-width: 2px 1px 2px 1px;}
			th{border: 1px solid gray; padding: 4px; background-color: #ddd;}
			td{border: 1px solid gray; padding: 4px;}
			tr:nth-child(2n){background-color: #f8f8f8;}
			pre{border: 2px solid #d6d6d6; padding: 0px; border-radius: 3px;}
		</style>
	</head>
	<body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space; ">
		<div>
			<h2 style="margin: 0px 0px 4px; font-size: 20px; color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;"><a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/nengm1988/p/7816618.html" style="color: rgb(34, 51, 85); text-decoration: none;"><span style="vertical-align: middle;">Tinyhttpd精读解析</span></a>
			</h2>
			<div class="postbody" style="color: rgb(0, 0, 0); font-family: 'PingFang SC', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; ">
				<div id="cnblogs_post_body" class="blogpost-body" style="margin-bottom: 20px; word-break: break-word; ">
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">&nbsp; &nbsp; &nbsp; &nbsp;首先，本人刚刚开始开源代码精读，写的不对的地方，大家轻拍，一起进步。本文是对Tinyhttpd的一次精读，大家每天都在用着http服务，很多人也一直活跃在上层，使用IIS、Apache等，大家是否想看看http服务器大概是怎么运作的，通过一个500多行的源码加上完整的注释，和大家逛一逛http服务器。Tinyhttpd真的非常适合阅读尤其是刚入门的，清晰的代码，简单的makefile...其实有很多分析tinyghttpd的，这边抱着人家写的是人家，自己写的才是自己的态度，写的尽量详细，尽量简单，很多都写在代码注释里面，也把学习中的一些坑翻出来和大家一起读读，吸取将近20年前的大神通过500行代码带给我们的财富。不管你是写c的，或者C#，js亦或java，只要用到http的都欢迎读读。<br />大家看后如果觉得我有写的不对的地方，欢迎指出~~
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">附上注解代码的github地址：
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">https://github.com/nengm/Tinyhttpd
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">1.首先是一张图 全解了Tinyhttp是如何运作的，我觉得图说明比我用文字描述的要清晰，语言功底不太给力。
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; "><img src="982709db_1a6c0459_0.png" />
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">&nbsp;2. 主要函数简略说明，代码中进行了详细注释。
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">main &nbsp; 　　　　　　&nbsp;主函数<br />startup	　　　&nbsp;　　&nbsp; 绑定监听套接字<br />accept_request	　 &nbsp; 每次收到请求，创建一个线程来处理接受到的请求<br />serve_file	　　　　 接读取文件返回给请求的http客户端<br />execute_cgi	　　　 执行cgi文件
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">3.注意点
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">注意点1：
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">index.html必须没有执行权限，否则看不到内容，并且会产生Program received signal SIGPIPE, Broken pipe，因为程序中如果有可执行权限会当cgi脚本处理。所以假如html有执行权限先把它去除了，chmod 600 index.html
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">color.cgi、date.cgi必须要有执行权限。
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">注意点2：
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">color.cgi是用perl写的，相信大家很少接触了。所以可以引用网上一个简单的例子，换成一个shell写的cgi测试
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">#!/bin/bash<br />echo &quot;Content-Type: text/html&quot;<br />echo<br />echo &quot;&lt;HTML&gt;&lt;BODY&gt;&quot;<br />echo &quot;&lt;CENTER&gt;Today is:&lt;/CENTER&gt;&quot;<br />echo &quot;&lt;CENTER&gt;&lt;B&gt;&quot;<br />date<br />echo &quot;&lt;/B&gt;&lt;/CENTER&gt;&quot;<br />echo &quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">4.操作<a href="file:///D:/guojicheng/桌面/imgclip.png">file:///D:/guojicheng/桌面/imgclip.pn</a>
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">1.执行make，生成成功，./httpd启动成功。
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; "><img src="https://images2017.cnblogs.com/blog/422590/201711/422590-20171110142730919-1794798383.png" alt="" style="border: 0px; height: auto; max-width: 100%;" />
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">2.如果在当前linux下的firefox下执行。直接在浏览器中输入
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; "><img src="https://images2017.cnblogs.com/blog/422590/201711/422590-20171110143132731-1356880718.png" alt="" style="border: 0px; height: auto; max-width: 100%;" />
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">3.在windows中测试，
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; "><img src="https://images2017.cnblogs.com/blog/422590/201711/422590-20171110143325638-1055397971.png" alt="" style="border: 0px; height: auto; max-width: 100%;" />
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">4.测试执行自带的perl写的cgi脚本
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">&nbsp;<img src="https://images2017.cnblogs.com/blog/422590/201711/422590-20171110143447888-1243264435.png" alt="" style="border: 0px; height: auto; max-width: 100%;" />
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">5.进入index2.html页面，测试shell写的cgi脚本。
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">&nbsp;<img src="https://images2017.cnblogs.com/blog/422590/201711/422590-20171110143657356-1261028620.png" alt="" style="border: 0px; height: auto; max-width: 100%;" />
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">&nbsp;
					</p>
					<p style="background-color: rgb(255, 255, 255); margin-top: 10px; margin-right: auto; margin-bottom: 10px; margin-left: auto; text-indent: 0px; ">
					</p>
					<div style="background-color: rgb(255, 255, 255); ">&nbsp;// Http请求，后续主要是处理这个头
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 73 //
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 74 // GET / HTTP/1.1
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 75 // Host: 192.168.0.23:47310
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 76 // Connection: keep-alive
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 77 // Upgrade-Insecure-Requests: 1
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 78 // User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 79 // Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*; q = 0.8
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 80 // Accept - Encoding: gzip, deflate, sdch
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 81 // Accept - Language : zh - CN, zh; q = 0.8
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 82 // Cookie: __guid = 179317988.1576506943281708800.1510107225903.8862; monitor_count = 5
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 83 //
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 84 
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 85 // POST / color1.cgi HTTP / 1.1
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 86 // Host: 192.168.0.23 : 47310
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 87 // Connection : keep - alive
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 88 // Content - Length : 10
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 89 // Cache - Control : max - age = 0
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 90 // Origin : http ://192.168.0.23:40786
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 91 // Upgrade - Insecure - Requests : 1
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 92 // User - Agent : Mozilla / 5.0 (Windows NT 6.1; WOW64) AppleWebKit / 537.36 (KHTML, like Gecko) Chrome / 55.0.2883.87 Safari / 537.36
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 93 // Content - Type : application / x - www - form - urlencoded
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 94 // Accept : text / html, application / xhtml + xml, application / xml; q = 0.9, image / webp, */*;q=0.8
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 95 // Referer: http://192.168.0.23:47310/
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 96 // Accept-Encoding: gzip, deflate
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 97 // Accept-Language: zh-CN,zh;q=0.8
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 98 // Cookie: __guid=179317988.1576506943281708800.1510107225903.8862; monitor_count=281
					</div>
					<div style="background-color: rgb(255, 255, 255); "> 99 // Form Data
					</div>
					<div style="background-color: rgb(255, 255, 255); ">100 // color=gray
					</div>
					<div style="background-color: rgb(255, 255, 255); "><br />
					</div>
					<div style="background-color: rgb(255, 255, 255); "><br />
					</div>
					<div style="background-color: rgb(255, 255, 255); "><br />
					</div>
					<div>
						<pre style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 22px; font-size: 12px; font-family: 'Courier New' !important; color: rgb(0, 0, 0); font-style: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; ">
<span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> J. David's webserver </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">  2</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> This is a simple webserver.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">  3</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Created November 1999 by J. David Blackstone.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">  4</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * CSE 4344 (Network concepts), Prof. Zeigler
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">  5</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * University of Texas at Arlington
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">  6</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">  7</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> This program compiles for Sparc Solaris 2.6.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">  8</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * To compile for Linux:
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">  9</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *  1) Comment out the #include &lt;pthread.h&gt; line.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 10</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *  2) Comment out the line that defines the variable newthread.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 11</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *  3) Comment out the two lines that run pthread_create().
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 12</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *  4) Uncomment the line that runs accept_request().
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 13</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *  5) Remove -lsocket from the Makefile.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 14</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 15</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;stdio.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 16</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;sys/socket.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 17</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;sys/types.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 18</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;netinet/</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">in</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 19</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;arpa/inet.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 20</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;unistd.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 21</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;ctype.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 22</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;strings.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 23</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">string</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 24</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;sys/stat.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 25</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;pthread.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 26</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;sys/wait.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 27</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> #include &lt;stdlib.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 28</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 29</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">宏定义，是否是空格</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 30</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">#define</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ISspace(x) isspace((int)(x))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 31</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 32</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">#define</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> SERVER_STRING "Server: jdbhttpd/0.1.0\r\n"
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 33</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 34</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">每次收到请求，创建一个线程来处理接受到的请求
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 35</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">把client_sock转成地址作为参数传入pthread_create</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 36</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> accept_request(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">arg);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 37</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 38</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">错误请求</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 39</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> bad_request(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 40</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 41</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">读取文件</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 42</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> cat(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, FILE *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 43</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 44</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">无法执行</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 45</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> cannot_execute(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 46</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 47</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">错误输出</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 48</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> error_die(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 49</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 50</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">执行cig脚本</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 51</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> execute_cgi(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 52</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 53</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">得到一行数据,只要发现c为\n,就认为是一行结束，如果读到\r,再用MSG_PEEK的方式读入一个字符，如果是\n，从socket用读出
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 54</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果是下个字符则不处理，将c置为\n，结束。如果读到的数据为0中断，或者小于0，也视为结束，c置为\n</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 55</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> get_line(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 56</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 57</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">返回http头</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 58</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> headers(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 59</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 60</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">没有发现文件</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 61</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> not_found(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 62</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 63</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果不是CGI文件，直接读取文件返回给请求的http客户端</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 64</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> serve_file(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 65</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 66</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">开启tcp连接，绑定端口等操作</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 67</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> startup(u_short *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 68</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 69</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果不是Get或者Post，就报方法没有实现</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 70</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> unimplemented(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 71</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 72</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Http请求，后续主要是处理这个头
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 73</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 74</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> GET / HTTP/1.1
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 75</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Host: 192.168.0.23:47310
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 76</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Connection: keep-alive
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 77</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Upgrade-Insecure-Requests: 1
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 78</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 79</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*; q = 0.8
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 80</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Accept - Encoding: gzip, deflate, sdch
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 81</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Accept - Language : zh - CN, zh; q = 0.8
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 82</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Cookie: __guid = 179317988.1576506943281708800.1510107225903.8862; monitor_count = 5
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 83</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 84</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 85</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> POST / color1.cgi HTTP / 1.1
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 86</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Host: 192.168.0.23 : 47310
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 87</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Connection : keep - alive
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 88</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Content - Length : 10
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 89</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Cache - Control : max - age = 0
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 90</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Origin : http :</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">192.168.0.23:40786
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 91</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Upgrade - Insecure - Requests : 1
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 92</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> User - Agent : Mozilla / 5.0 (Windows NT 6.1; WOW64) AppleWebKit / 537.36 (KHTML, like Gecko) Chrome / 55.0.2883.87 Safari / 537.36
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 93</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Content - Type : application / x - www - form - urlencoded
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 94</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Accept : text / html, application / xhtml + xml, application / xml; q = 0.9, image / webp, */*;q=0.8
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 95</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Referer: </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); text-decoration: underline; ">http://192.168.0.23</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">:47310/
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 96</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Accept-Encoding: gzip, deflate
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 97</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Accept-Language: zh-CN,zh;q=0.8
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 98</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Cookie: __guid=179317988.1576506943281708800.1510107225903.8862; monitor_count=281
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); "> 99</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Form Data
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">100</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> color=gray</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">101</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">102</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">103</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> A request has caused a call to accept() on the server port to
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">104</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * return.  Process the request appropriately.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">105</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameters: the socket connected to the client </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">106</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">107</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> accept_request(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">arg)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">108</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">109</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">socket</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">110</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> client =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> (intptr_t)arg;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">111</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">112</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> numchars;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">113</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> method[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">255</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">114</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> url[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">255</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">115</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> path[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">512</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">116</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> size_t i, j;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">117</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">struct</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> stat st;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">118</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> cgi = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">;      </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> becomes true if server decides this is a CGI
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">119</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">                    * program </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">120</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *query_string =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> NULL;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">121</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">根据上面的Get请求，可以看到这边就是取第一行
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">122</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">这边都是在处理第一条http信息
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">123</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">"GET / HTTP/1.1\n"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">124</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  numchars = get_line(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf));
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">125</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  i = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">; j = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">126</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">127</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">第一行字符串提取Get</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">128</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (!ISspace(buf[j]) &amp;&amp; (i &lt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(method) - </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">129</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">130</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   method[i] =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> buf[j];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">131</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   i++; j++</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">132</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">133</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">结束</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">134</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  method[i] = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">135</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">136</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">判断是Get还是Post</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">137</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (strcasecmp(method, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">GET</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; strcasecmp(method, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">POST</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">138</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">139</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  unimplemented(client);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">140</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">return</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">141</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">142</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">143</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果是POST，cgi置为1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">144</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (strcasecmp(method, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">POST</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">145</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   cgi = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">146</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">147</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  i = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">148</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">跳过空格</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">149</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (ISspace(buf[j]) &amp;&amp; (j &lt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf)))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">150</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   j++</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">151</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">152</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">得到 "/"   注意：如果你的http的网址为http:</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">192.168.0.23:47310/index.html
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">153</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">               那么你得到的第一条http信息为GET /index.html HTTP/1.1，那么
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">154</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">               解析得到的就是/index.html</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">155</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (!ISspace(buf[j]) &amp;&amp; (i &lt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(url) - </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; (j &lt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf)))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">156</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">157</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   url[i] =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> buf[j];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">158</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   i++; j++</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">159</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">160</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  url[i] = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">161</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">162</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">判断Get请求</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">163</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (strcasecmp(method, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">GET</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">164</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">165</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   query_string =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> url;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">166</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((*query_string != </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">?</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; (*query_string != </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">167</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    query_string++</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">168</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (*query_string == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">?</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">169</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">170</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    cgi = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">171</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    *query_string = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">172</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    query_string++</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">173</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">174</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">175</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">176</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">路径</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">177</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(path, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">htdocs%s</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">, url);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">178</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">179</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">默认地址，解析到的路径如果为/，则自动加上index.html</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">180</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (path[strlen(path) - </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">] == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">/</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">181</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   strcat(path, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">index.html</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">182</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">183</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">获得文件信息</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">184</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (stat(path, &amp;st) == -</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">) {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">185</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">把所有http信息读出然后丢弃</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">186</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((numchars &gt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; strcmp(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, buf))  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> read &amp; discard headers </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">187</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    numchars = get_line(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf));
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">188</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">189</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">没有找到</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">190</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  not_found(client);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">191</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">192</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">else</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">193</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">194</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((st.st_mode &amp; S_IFMT) ==</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> S_IFDIR)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">195</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    strcat(path, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">/index.html</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">196</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果你的文件默认是有执行权限的，自动解析成cgi程序，如果有执行权限但是不能执行，会接受到报错信号</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">197</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((st.st_mode &amp; S_IXUSR) ||
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">198</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">       (st.st_mode &amp; S_IXGRP) ||
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">199</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">       (st.st_mode &amp;</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> S_IXOTH)    )
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">200</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    cgi = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">201</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (!</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">cgi)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">202</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">接读取文件返回给请求的http客户端</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">203</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">   serve_file(client, path);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">204</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">else</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">205</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">执行cgi文件</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">206</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">   execute_cgi(client, path, method, query_string);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">207</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">208</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">执行完毕关闭socket</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">209</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> close(client);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">210</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">211</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">212</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">213</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Inform the client that a request it has made has a problem.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">214</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameters: client socket </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">215</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">216</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> bad_request(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> client)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">217</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">218</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">219</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">220</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">HTTP/1.0 400 BAD REQUEST\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">221</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">222</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">Content-type: text/html\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">223</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">224</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">225</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">226</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;P&gt;Your browser sent a bad request, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">227</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">228</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">such as a POST without a Content-Length.\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">229</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">230</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">231</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">232</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">233</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Put the entire contents of a file out on a socket.  This function
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">234</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * is named after the UNIX "cat" command, because it might have been
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">235</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * easier just to do something like pipe, fork, and exec("cat").
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">236</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameters: the client socket descriptor
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">237</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *             FILE pointer for the file to cat </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">238</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">239</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">240</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">得到文件内容，发送</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">241</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> cat(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> client, FILE *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">resource)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">242</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">243</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">244</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">245</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  fgets(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf), resource);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">246</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">循环读</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">247</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (!</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">feof(resource))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">248</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">249</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">250</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   fgets(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf), resource);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">251</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">252</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">253</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">254</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">255</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Inform the client that a CGI script could not be executed.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">256</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameter: the client socket descriptor. </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">257</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">258</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> cannot_execute(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> client)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">259</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">260</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">261</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">262</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">HTTP/1.0 500 Internal Server Error\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">263</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">264</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">Content-type: text/html\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">265</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">266</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">267</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">268</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;P&gt;Error prohibited CGI execution.\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">269</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">270</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">271</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">272</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">273</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Print out an error message with perror() (for system errors; based
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">274</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * on value of errno, which indicates system call errors) and exit the
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">275</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * program indicating an error. </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">276</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">277</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> error_die(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">sc)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">278</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">279</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> perror(sc);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">280</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  exit(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">281</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">282</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">283</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">284</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Execute a CGI script.  Will need to set environment variables as
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">285</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * appropriate.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">286</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameters: client socket descriptor
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">287</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *             path to the CGI script </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">288</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">289</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> execute_cgi(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> client, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">path,
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">290</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">                  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *method, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">query_string)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">291</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">292</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">缓冲区</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">293</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">294</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">295</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">2根管道</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">296</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> cgi_output[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">2</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">297</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> cgi_input[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">2</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">298</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">299</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">进程pid和状态</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">300</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> pid_t pid;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">301</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> status;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">302</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">303</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> i;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">304</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> c;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">305</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">306</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">读取的字符数</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">307</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> numchars = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">308</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">309</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">http的content_length</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">310</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> content_length = -</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">311</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">312</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">默认字符</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">313</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">] = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">A</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">; buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">] = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">314</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">315</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">忽略大小写比较字符串</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">316</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (strcasecmp(method, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">GET</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">317</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">读取数据，把整个header都读掉，以为Get写死了直接读取index.html，没有必要分析余下的http信息了</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">318</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((numchars &gt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; strcmp(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, buf))  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> read &amp; discard headers </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">319</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    numchars = get_line(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf));
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">320</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">else</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> POST </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">321</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">322</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   numchars = get_line(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf));
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">323</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((numchars &gt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; strcmp(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">, buf))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">324</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">325</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果是POST请求，就需要得到Content-Length，Content-Length：这个字符串一共长为15位，所以
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">326</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">取出头部一句后，将第16位设置结束符，进行比较
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">327</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">第16位置为结束</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">328</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">15</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">] = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">329</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (strcasecmp(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">Content-Length:</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">330</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">内存从第17位开始就是长度，将17位开始的所有字符串转成整数就是content_length</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">331</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">     content_length = atoi(&amp;(buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">16</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">]));
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">332</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    numchars = get_line(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf));
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">333</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">334</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (content_length == -</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">) {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">335</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">   bad_request(client);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">336</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">return</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">337</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">338</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">339</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">340</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">HTTP/1.0 200 OK\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">341</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">342</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">建立output管道</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">343</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (pipe(cgi_output) &lt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">) {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">344</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  cannot_execute(client);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">345</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">return</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">346</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">347</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">348</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">/</span><span class="Apple-style-span" style="background-color: rgb(192, 192, 192);">/</span></span><span class="Apple-style-span" style="background-color: rgb(192, 192, 192);"><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">建立input管道</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">349</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span> (pipe(cgi_input) &lt; <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">) {
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">350</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  cannot_execute(client);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">351</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">return</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">352</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">353</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">       fork后管道都复制了一份，都是一样的
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">354</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">       子进程关闭2个无用的端口，避免浪费             
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">355</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">       ×&lt;-------------------------&gt;1    output
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">356</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">       0&lt;--------------------------&gt;×   input 
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">357</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">358</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">       父进程关闭2个无用的端口，避免浪费             
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">359</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">       0&lt;--------------------------&gt;×   output
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">360</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">       ×&lt;-------------------------&gt;1    input
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">361</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">       此时父子进程已经可以通信
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">362</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">363</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">364</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">fork进程，子进程用于执行CGI
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">365</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">父进程用于收数据以及发送子进程处理的回复数据</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">366</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span> ( (pid = fork()) &lt; <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> ) {
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">367</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  cannot_execute(client);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">368</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">return</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">369</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">370</span>  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span> (pid == <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span>)  <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> child: CGI script </span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">371</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">372</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span> meth_env[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">255</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">373</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span> query_env[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">255</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">374</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span> length_env[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">255</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">375</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">376</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">子进程输出重定向到output管道的1端</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">377</span>   dup2(cgi_output[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span>], <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">378</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">子进程输入重定向到input管道的0端</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">379</span>   dup2(cgi_input[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span>], <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">380</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">381</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">关闭无用管道口</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">382</span>   close(cgi_output[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">]);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">383</span>   close(cgi_input[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">]);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">384</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">385</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">CGI环境变量</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">386</span>   sprintf(meth_env, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">REQUEST_METHOD=%s</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">, method);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">387</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  putenv(meth_env);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">388</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span> (strcasecmp(method, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">GET</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span>) == <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">) {
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">389</span>    sprintf(query_env, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">QUERY_STRING=%s</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">, query_string);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">390</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">   putenv(query_env);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">391</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  }
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">392</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">else</span> {   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> POST </span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">393</span>    sprintf(length_env, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">CONTENT_LENGTH=%d</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">, content_length);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">394</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">   putenv(length_env);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">395</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  }
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">396</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">替换执行path</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">397</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  execl(path, path, NULL);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">398</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">int m = execl(path, path, NULL);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">399</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果path有问题，例如将html网页改成可执行的，但是执行后m为-1
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">400</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">退出子进程，管道被破坏，但是父进程还在往里面写东西，触发Program received signal SIGPIPE, Broken pipe.</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">401</span>   exit(<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">402</span>  } <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">else</span> {    <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> parent </span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">403</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">404</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">关闭无用管道口</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">405</span>   close(cgi_output[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">]);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">406</span>   close(cgi_input[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">]);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">407</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span> (strcasecmp(method, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">POST</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span>) == <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">408</span>    <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">for</span> (i = <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span>; i &lt; content_length; i++<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">) {
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">409</span>     <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">得到post请求数据，写到input管道中，供子进程使用</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">410</span>     recv(client, &amp;c, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span>, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">411</span>     write(cgi_input[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span>], &amp;c, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">412</span> <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">   }
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">413</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">从output管道读到子进程处理后的信息，然后send出去</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">414</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span> (read(cgi_output[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span>], &amp;c, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span>) &gt; <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">415</span>    send(client, &amp;c, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span>, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">416</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">417</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">完成操作后关闭管道</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">418</span>   close(cgi_output[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">]);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">419</span>   close(cgi_input[<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">]);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">420</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">421</span>   <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">等待子进程返回</span>
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">422</span>   waitpid(pid, &amp;status, <span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">423</span> 
<span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">424</span> </span><span style="font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "><span class="Apple-style-span" style="background-color: rgb(192, 192, 192);"> }</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span></span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">425</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">426</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">427</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">428</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Get a line from a socket, whether the line ends in a newline,
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">429</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * carriage return, or a CRLF combination.  Terminates the string read
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">430</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * with a null character.  If no newline indicator is found before the
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">431</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * end of the buffer, the string is terminated with a null.  If any of
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">432</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * the above three line terminators is read, the last character of the
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">433</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * string will be a linefeed and the string will be terminated with a
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">434</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * null character.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">435</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameters: the socket descriptor
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">436</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *             the buffer to save the data in
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">437</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *             the size of the buffer
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">438</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Returns: the number of bytes stored (excluding null) </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">439</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">440</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">441</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">得到一行数据,只要发现c为\n,就认为是一行结束，如果读到\r,再用MSG_PEEK的方式读入一个字符，如果是\n，从socket用读出
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">442</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果是下个字符则不处理，将c置为\n，结束。如果读到的数据为0中断，或者小于0，也视为结束，c置为\n</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">443</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> get_line(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> sock, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> size)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">444</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">445</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> i = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">446</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> c = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">447</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> n;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">448</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">449</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((i &lt; size - </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; (c != </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">450</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">451</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   n = recv(sock, &amp;c, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">452</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> DEBUG printf("%02X\n", c); </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">453</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (n &gt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">454</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">455</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (c == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\r</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">456</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">   {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">457</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">      </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">偷窥一个字节，如果是\n就读走</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">458</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">     n = recv(sock, &amp;c, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">, MSG_PEEK);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">459</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">     </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> DEBUG printf("%02X\n", c); </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">460</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">     </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((n &gt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; (c == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">))
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">461</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">      recv(sock, &amp;c, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">462</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">     </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">else</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">463</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">     </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">不是\n（读到下一行的字符）或者没读到，置c为\n 跳出循环,完成一行读取</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">464</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">      c = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">465</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">   }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">466</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    buf[i] =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> c;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">467</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    i++</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">468</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">469</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">else</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">470</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    c = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">471</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">472</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  buf[i] = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">473</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">474</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">return</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(i);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">475</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">476</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">477</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">478</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Return the informational HTTP headers about a file. </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">479</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Parameters: the socket to print the headers on
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">480</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *             the name of the file </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">481</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">482</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">483</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">加入http的headers</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">484</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> headers(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> client, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">filename)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">485</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">486</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">487</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  (</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">)filename;  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> could use filename to determine file type </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">488</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">489</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  strcpy(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">HTTP/1.0 200 OK\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">490</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">491</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> strcpy(buf, SERVER_STRING);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">492</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">493</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">Content-Type: text/html\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">494</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">495</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  strcpy(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">496</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">497</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">498</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">499</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">500</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Give a client a 404 not found status message. </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">501</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">502</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">503</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果资源没有找到得返回给客户端下面的信息</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">504</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> not_found(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> client)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">505</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">506</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">507</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">508</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">HTTP/1.0 404 NOT FOUND\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">509</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">510</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> sprintf(buf, SERVER_STRING);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">511</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">512</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">Content-Type: text/html\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">513</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">514</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">515</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">516</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;HTML&gt;&lt;TITLE&gt;Not Found&lt;/TITLE&gt;\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">517</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">518</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;BODY&gt;&lt;P&gt;The server could not fulfill\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">519</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">520</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">your request because the resource specified\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">521</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">522</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">is unavailable or nonexistent.\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">523</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">524</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;/BODY&gt;&lt;/HTML&gt;\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">525</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">526</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">527</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">528</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">529</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Send a regular file to the client.  Use headers, and report
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">530</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * errors to client if they occur.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">531</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameters: a pointer to a file structure produced from the socket
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">532</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *              file descriptor
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">533</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> *             the name of the file to serve </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">534</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">535</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">536</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果不是CGI文件，直接读取文件返回给请求的http客户端</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">537</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> serve_file(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> client, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">const</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">filename)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">538</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">539</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  FILE *resource =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> NULL;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">540</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> numchars = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">541</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">542</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">543</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">默认字符</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">544</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">] = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">A</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">; buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">] = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">'</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">545</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> ((numchars &gt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &amp;&amp; strcmp(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, buf))  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> read &amp; discard headers </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">546</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   numchars = get_line(client, buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(buf));
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">547</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">548</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  resource = fopen(filename, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">r</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">549</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (resource ==</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> NULL)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">550</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  not_found(client);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">551</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">else</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">552</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">553</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  headers(client, filename);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">554</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">  cat(client, resource);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">555</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">556</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> fclose(resource);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">557</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">558</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">559</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">560</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> This function starts the process of listening for web connections
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">561</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * on a specified port.  If the port is 0, then dynamically allocate a
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">562</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * port and modify the original port variable to reflect the actual
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">563</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * port.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">564</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameters: pointer to variable containing the port to connect on
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">565</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Returns: the socket </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">566</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">567</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> startup(u_short *</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">port)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">568</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">569</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> httpd = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">570</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">struct</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> sockaddr_in name;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">571</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">572</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  httpd = socket(PF_INET, SOCK_STREAM, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">573</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (httpd == -</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">574</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   error_die(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">socket</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">575</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  memset(&amp;name, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(name));
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">576</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  name.sin_family =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> AF_INET;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">577</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  name.sin_port = htons(*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">port);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">578</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  name.sin_addr.s_addr =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> htonl(INADDR_ANY);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">579</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">绑定socket</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">580</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (bind(httpd, (</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">struct</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> sockaddr *)&amp;name, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(name)) &lt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">581</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   error_die(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">bind</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">582</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果端口没有设置，提供个随机端口</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">583</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (*port == </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">)  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> if dynamically allocating a port </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">584</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">585</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   socklen_t  namelen = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(name);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">586</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (getsockname(httpd, (</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">struct</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> sockaddr *)&amp;name, &amp;namelen) == -</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">587</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">    error_die(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">getsockname</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">588</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   *port =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> ntohs(name.sin_port);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">589</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">590</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">监听</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">591</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (listen(httpd, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">5</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">) &lt; </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">592</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   error_die(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">listen</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">593</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">return</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(httpd);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">594</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">595</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">596</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">597</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> Inform the client that the requested web method has not been
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">598</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * implemented.
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">599</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> * Parameter: the client socket </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">600</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">601</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">602</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">如果方法没有实现，就返回此信息</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">603</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> unimplemented(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> client)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">604</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">605</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">char</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> buf[</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1024</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">];
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">606</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">607</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">HTTP/1.0 501 Method Not Implemented\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">608</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">609</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> sprintf(buf, SERVER_STRING);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">610</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">611</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">Content-Type: text/html\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">612</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">613</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">614</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">615</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Method Not Implemented\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">616</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">617</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;/TITLE&gt;&lt;/HEAD&gt;\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">618</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">619</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;BODY&gt;&lt;P&gt;HTTP request method not supported.\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">620</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">621</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  sprintf(buf, </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">&lt;/BODY&gt;&lt;/HTML&gt;\r\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">622</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  send(client, buf, strlen(buf), </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">623</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">}
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">624</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">625</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">********************************************************************</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">626</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">627</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> main(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">628</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">{
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">629</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> server_sock = -</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">630</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  u_short port = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">631</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">int</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> client_sock = -</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">632</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">struct</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> sockaddr_in client_name;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">633</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">634</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">这边要为socklen_t类型</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">635</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  socklen_t client_name_len = </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">sizeof</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">(client_name);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">636</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> pthread_t newthread;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">637</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">638</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  server_sock = startup(&amp;</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">port);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">639</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  printf(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">httpd running on port %d\n</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">, port);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">640</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">641</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">while</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">642</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> {
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">643</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">      </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">接受请求，函数原型
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">644</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">      </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">#include &lt;sys/types.h&gt;
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">645</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">      </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">#include &lt;sys/socket.h&gt;  
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">646</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">      </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">647</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   client_sock =</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> accept(server_sock,
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">648</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">                        (</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">struct</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> sockaddr *)&amp;</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">client_name,
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">649</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">                        &amp;</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">client_name_len);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">650</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (client_sock == -</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">1</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">651</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">       error_die(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">accept</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">652</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">/*</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); "> accept_request(client_sock); </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">*/</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">653</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">654</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">每次收到请求，创建一个线程来处理接受到的请求
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">655</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">//</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 0); ">把client_sock转成地址作为参数传入pthread_create</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">656</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">   </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">if</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> (pthread_create(&amp;newthread, NULL, (</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *)accept_request, (</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">void</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> *)(intptr_t)client_sock) != </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">)
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">657</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">       perror(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">pthread_create</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 0); ">"</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">658</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> }
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">659</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">660</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); "> close(server_sock);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">661</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> 
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">662</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">  </span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 255); ">return</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);">(</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(128, 0, 128); ">0</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 0, 0); ">);
</span><span style="background-color: rgb(255, 255, 255); font-family: 'Courier New' !important; font-size: 12px !important; line-height: 1.5 !important; color: rgb(0, 128, 128); ">663</span><span class="Apple-style-span" style="background-color: rgb(255, 255, 255);"> }</span></pre>
					</div>
					<div style="background-color: rgb(255, 255, 255); "><br />
					</div>
					<p style="background-color: rgb(255, 255, 255); ">
					</p>
				</div>
			</div>
		</div>
	
<footer style="">
<hr noshade>
<a href="982709db_1a6c0459_0.png" title="982709db_1a6c0459_0.png" target=_blank style="padding-left: 1em; background: URL(icon_attachment.gif) no-repeat center left; padding: 0 0 0 16px;">imgclip.png</a>
<hr noshade>
</footer>
<script type="text/javascript" language="javascript" src="jquery.js"></script>
<script type="text/javascript" language="javascript" src="itemlink.js"></script></body>
</html>